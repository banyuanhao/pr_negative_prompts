<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <!-- Meta tags for social media banners, these should be filled in appropriatly as they are your "business card" -->
  <!-- Replace the content tag with appropriate information -->
  <meta name="description" content="DESCRIPTION META TAG">
  <meta property="og:title" content="SOCIAL MEDIA TITLE TAG"/>
  <meta property="og:description" content="SOCIAL MEDIA DESCRIPTION TAG TAG"/>
  <meta property="og:url" content="URL OF THE WEBSITE"/>
  <!-- Path to banner image, should be in the path listed below. Optimal dimenssions are 1200X630-->
  <meta property="og:image" content="static/image/your_banner_image.png" />
  <meta property="og:image:width" content="1200"/>
  <meta property="og:image:height" content="630"/>


  <meta name="twitter:title" content="TWITTER BANNER TITLE META TAG">
  <meta name="twitter:description" content="TWITTER BANNER DESCRIPTION META TAG">
  <!-- Path to banner image, should be in the path listed below. Optimal dimenssions are 1200X600-->
  <meta name="twitter:image" content="static/images/your_twitter_banner_image.png">
  <meta name="twitter:card" content="summary_large_image">
  <!-- Keywords for your paper to be indexed by-->
  <meta name="keywords" content="KEYWORDS SHOULD BE PLACED HERE">
  <meta name="viewport" content="width=device-width, initial-scale=1">


  <title>Negative Prompts Mystery</title>
  <link rel="icon" type="image/x-icon" href="static/images/images.ico">
  <link href="https://fonts.googleapis.com/css?family=Google+Sans|Noto+Sans|Castoro"
  rel="stylesheet">

  <link rel="stylesheet" href="static/css/bulma.min.css">
  <link rel="stylesheet" href="static/css/bulma-carousel.min.css">
  <link rel="stylesheet" href="static/css/bulma-slider.min.css">
  <link rel="stylesheet" href="static/css/fontawesome.all.min.css">
  <link rel="stylesheet"
  href="https://cdn.jsdelivr.net/gh/jpswalsh/academicons@1/css/academicons.min.css">
  <link rel="stylesheet" href="static/css/index.css">

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://documentcloud.adobe.com/view-sdk/main.js"></script>
  <script defer src="static/js/fontawesome.all.min.js"></script>
  <script src="static/js/bulma-carousel.min.js"></script>
  <script src="static/js/bulma-slider.min.js"></script>
  <script src="static/js/index.js"></script>
</head>
<body>


    <section class="hero">
      <div class="hero-body">
        <div class="container is-max-desktop">
          <div class="columns is-centered">
            <div class="column has-text-centered">
              <h1 class="title is-1 publication-title">Understanding the Impact of Negative Prompts: When and How Do They Take Effect?</h1>
              <div class="is-size-5 publication-authors">
                <!-- Paper authors -->
                <span class="author-block">
                  <a href="https://github.com/banyuanhao" target="_blank">Yuanhao Ban</a>,</span>
                  <span class="author-block">
                    <a href="https://ruocwang.github.io/" target="_blank">Ruochen Wang</a>,</span>
                    <span class="author-block">
                      <a href="https://tianyizhou.github.io/" target="_blank">Tianyi Zhou</a>,
                    </span>

                  </span>
                  <a href="https://cmhcbb.github.io/" target="_blank">Minhao Cheng</a>
                  </span>

                    <a href="http://boqinggong.info/ target="_blank">Boqing Gong</a>,
                    </span>
                    <a href="https://web.cs.ucla.edu/~chohsieh/" target="_blank">Cho-Jui Hsieh</a>,
                    </div>
  
                    <div class="is-size-5 publication-authors">
                      <span class="author-block">UCLA - UMD - Google - PSU<br>Submitted to NeurIPS 2024</span>
                    </div>
  
                    <div class="arc-collaboration">
                      <span style="font-size: 24px; color: red;">A</span><span style="font-size: 20px;">IGC </span>
                      <span style="font-size: 24px; color: red;">R</span><span style="font-size: 20px;">esearch </span>
                      <span style="font-size: 24px; color: red;">C</span><span style="font-size: 20px;">ollaboration</span>
                  </div>
                  
                    <div class="column has-text-centered">
                      <div class="publication-links">
                           <!-- Arxiv PDF link -->
                        <span class="link-block">
                          <a href="https://arxiv.org/pdf/2406.01970.pdf" target="_blank"
                          class="external-link button is-normal is-rounded is-dark">
                          <span class="icon">
                            <i class="fas fa-file-pdf"></i>
                          </span>
                          <span>Paper</span>
                        </a>
                      </span>
  
  
                    <!-- Github link -->
                    <span class="link-block">
                      <a href="https://github.com/odfn" target="_blank"
                      class="external-link button is-normal is-rounded is-dark">
                      <span class="icon">
                        <i class="fab fa-github"></i>
                      </span>
                      <span>Code</span>
                    </a>
                  </span>
  
                  <!-- ArXiv abstract Link -->
                  <span class="link-block">
                    <a href="https://arxiv.org/abs/2406.01970" target="_blank"
                    class="external-link button is-normal is-rounded is-dark">
                    <span class="icon">
                      <i class="ai ai-arxiv"></i>
                    </span>
                    <span>arXiv</span>
                  </a>
                </span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
<div style="width: 70%; margin: auto;">
  <p> We investigate the mechanisms of negative prompts in Text2Image diffusion models and discover that they exhibit different behaviors compared to positive prompts. In the following figure, the first and third rows display the cross-attention heat map of words in the positive prompt, while the second and fourth rows show those of the negative prompt. We observe that the negative prompt exhibits a delayed response which means they usually attend to the target position later than the positive prompt.
  </p>
</div>
<img src="static/images/first.png" alt="Illustration" style="display: block; margin: auto; width:50%; height:auto;margin-bottom: 5px;">

<!-- Paper abstract -->
<section class="section hero is-light">
  <div class="container is-max-desktop">
    <div class="columns is-centered has-text-centered">
      <div class="column is-four-fifths">
        <h2 class="title is-3">Abstract</h2>
        <div class="content has-text-justified">
          <p>
            The concept of negative prompts, emerging from conditional generation models like Stable Diffusion, allows users to specify what to exclude from the generated images.Despite the widespread use of negative prompts, their intrinsic mechanisms remain largely unexplored. This paper presents the first comprehensive study to uncover how and when negative prompts take effect. Our extensive empirical analysis identifies two primary behaviors of negative prompts. Delayed Effect: The impact of negative prompts is observed after positive prompts render corresponding content. Deletion Through Neutralization: Negative prompts delete concepts from the generated image through a mutual cancellation effect in latent space with positive prompts. These insights reveal significant potential real-world applications; for example, we demonstrate that negative prompts can facilitate object inpainting with minimal alterations to the background via a simple adaptive algorithm. We believe our findings will offer valuable insights for the community in capitalizing on the potential of negative prompts.
          </p>
        </div>
      </div>
    </div>
  </div>
</section>
<!-- End paper abstract -->

<div style="margin-left: 15%;margin-bottom: 10px;">
  <p style="font-size: 24px; font-weight: bold;">When do negative prompts take effect</p>
</div>

<div style="width: 70%; margin:auto;margin-bottom: 5px;">
  <p>
    We define a metric called the Negative Prompt Strength (Ratio) to quantify the investigate the timing of negative prompts, which is based on the mean value of the cross-attention map. The higher the value is, the more effective the negative prompt is. The following figure shows the ratios for both adjectives and noun. 
  </p>
  <p>
    For nouns, we find a peak at the 5th step for the noun-based negative prompt. Before that the target object haven't been fully formed, so the negative prompt has little effect. As we approach the peak, the negative prompt begins to assimilate layout cues from its positive counterpart, trying to remove the object. After the peak, as the element gradually disappears from the image, the impact of the negative prompt diminishes.
  </p>
  <p>
    For adjectives, we observe a plateau around the 10th step for adjective-based negative prompts, indicating the existence of the critical step. During the initial stages, the absence of the object leads to a subdued response, with the strength below one. Between the 5th and 10th steps, as the object becomes clear, the negative prompt accurately focuses on the intended area and maintains its influence.
  </p>
</div>

<img src="static/images/second.png" alt="Results" style="display: block; margin: auto; width:60%; height:auto;margin-bottom: 20px;">


<div style="margin-left: 15%;margin-bottom: 10px;">
  <p style="font-size: 24px; font-weight: bold;">How do negative prompts take effect?</p>
</div>

<div style="width: 70%; margin:auto;margin-bottom: 5px;">
  <p>
    We hypothesize that the negative prompts initially generate a target object at a specific location within the image, which neutralizes the positive noise through a subtractive process, effectively erasing the object. 
  </p>

  <p>
    During experiments, we discovered an interesting phenomenon called the Reverse Effect, which may be linked to the mechanism. As shown in the figure, each column displays an image generated by applying negative prompts at specific steps indicated at the top. In these examples, the diffusion process without a negative prompt does not produce the object mentioned in the negative prompt. However, introducing a negative prompt in the early stages results in the generation of the specified object, highlighted with a red bounding box.
  </p>
</div>

<img src="static/images/third.png" alt="Results" style="display: block; margin: auto; width:60%; height:auto;margin-bottom: 20px;">

<div style="width: 70%; margin:auto;margin-bottom: 5px;">
  <p>
    To give an explanation for Reverse Effect, we first take a look at the energy functionn in the image generation dynamtics. The function is designed to assign lower energy levels to more ’likely’ or ’natural’ images according to the model’s training data, and higher energy levels to less likely ones. As Real-world distributions often feature elements like a clear blue sky or other uniform backgrounds, alongside distinct objects such as the Eiffel Tower, these elements typically possess low energy scores, making the model inclined to generate them. To
    synthesize a specific object like a tower from scratch, the diffusion process necessarily traverses
    through an intermediary phase that represents a blurry outline of the object. Given that such blurry
    representations are atypical in the training data, they present an ’energy barrier’ that hinders the
    seamless generation of the desired object. So the model requires the guidance of prompts to surmount
    this barrier.
  </p>
</div>

<img src="static/images/fifth.png" alt="Results" style="display: block; margin: auto; width:60%; height:auto;margin-bottom: 20px;">

<div style="width: 70%; margin:auto;margin-bottom: 5px;">
  <p>
    To begin with, Figure (a) demonstrates that in the absence of explicit guidance, the model struggles to overcome the energy function’s barrier, influenced by the natural data distribution, leading it back to generic backgrounds. Conversely, as depicted in Figure (b), when explicit guidance is provided through the inclusion of the object in the positive prompt’s context, the model manages to surpass the barrier, with real-world distribution guidance steering it towards the object region.
  </p>

  <p>
    Figure (c) illustrate an
    instance where direct negative prompts
    are applied, yet the context is absent from
    the positive prompt. As a result, the neg-
    ative prompt guidance is much stronger
    than the positive prompt guidance, mak-
    ing this point at a considerable distance
    in the region opposite to the object. Con-
    sequently, the distribution guidance
    demonstrates a substantial alignment
    towards the object and its surrounding
    area. Without this, a tower-like struc-
    ture would emerge at that location. This
    is because adding or subtracting tower-
    like features against a uniform backdrop
    equally contributes to the formation of a
    tower pattern. As the distribution guid-
    ance is encoded into the estimated noises,
    projecting the positive noise towards the
    background-to-object direction reveals
    an enhanced effect in this direction, as
    opposed to the scenario without a nega-
    tive prompt in ig 6a. We term the phe-
    nomenon as the "Inducing Effect", indi-
    cating that the negative prompt triggers
    the positive noise in a direction that repre-
    sents the context of the negative prompt.
  </p>

  <p>
    Finally, we can explain the Reverse Effect in figure (4). Figure~\ref{fig:how_four}\red{a} demonstrates that without the negative prompt, the implicit guidance is insufficient to generate the intended object, explaining why the object fails to appear in the first column of Figure~\ref{fig:how_constra}. Conversely, as illustrated in Figure~\ref{fig:how_four}\red{c}, the application of a negative prompt intensifies the distribution guidance towards the object, which prevents the object from materializing, clarifying the absence of the object in the last several columns of Figure~\ref{fig:how_constra}. Intriguingly, as supported by the Momentum Effect, if we remove the negative prompt after several steps, the real-world distribution guidance will maintain a large component towards the object's direction in the following steps as shown in Fig~\ref{fig:how_four}\red{d}. Such a momentum effect finally facilitates the object's emergence, as shown in the middle columns in 
  </p>
</div>

<img src="static/images/forth.png" alt="Results" style="display: block; margin: auto; width:60%; height:auto;margin-bottom: 20px;">

<div style="margin-left: 15%;margin-bottom: 10px;">
  <p style="font-size: 24px; font-weight: bold;">Application: Enhanced Controllable Inpainting.</p>
</div>

<div style="width: 70%; margin:auto;margin-bottom: 5px;">
  <p>
    
  </p>
</div>

<img src="static/images/sixth.png" alt="Results" style="display: block; margin: auto; width:60%; height:auto;margin-bottom: 20px;">

<!--BibTex citation -->
  <section class="section" id="BibTeX">
    <div class="container is-max-desktop content">
      <h2 class="title">BibTeX</h2>
      <pre><code>@article{ban2024understanding,
        title={Understanding the Impact of Negative Prompts: When and How Do They Take Effect?},
        author={Ban, Yuanhao and Wang, Ruochen and Zhou, Tianyi and Cheng, Minhao and Gong, Boqing and Hsieh, Cho-Jui},
        journal={arXiv preprint arXiv:2406.02965},
        year={2024}
      }</code></pre>
    </div>
</section>
<!--End BibTex citation -->


  <footer class="footer">
  <div class="container">
    <div class="columns is-centered">
      <div class="column is-8">
        <div class="content">

          <p>
            This page was built using the <a href="https://github.com/eliahuhorwitz/Academic-project-page-template" target="_blank">Academic Project Page Template</a> which was adopted from the <a href="https://nerfies.github.io" target="_blank">Nerfies</a> project page.
            You are free to borrow the of this website, we just ask that you link back to this page in the footer. <br> This website is licensed under a <a rel="license"  href="http://creativecommons.org/licenses/by-sa/4.0/" target="_blank">Creative
            Commons Attribution-ShareAlike 4.0 International License</a>.
          </p>

        </div>
      </div>
    </div>
  </div>
</footer>

<!-- Statcounter tracking code -->
  
<!-- You can add a tracker to track page visits by creating an account at statcounter.com -->

    <!-- End of Statcounter Code -->

  </body>
  </html>
